{
  "info": {
    "title": "SDF model for the Modbus message (transmission) layer", 
    "version": "2020-06-15", 
    "copyright": "Copyright 2020, Michael J. Koster\n        All rights reserved.", 
    "license": "https://github.com/one-data-model/oneDM/blob/master/LICENSE"
  }, 
  "namespace": {
    "fb": "https://onedm.org/exploratory/fieldbus/"
  }, 
  "defaultNamespace": "fb", 
  "sdfObject": {
    "modbusMessage": {
      "description": "The Modbus message layer",
      "label": "Modbus Message Layer",

      "sdfProperty": {
        "modbusRequestMessage": {
          "sdfChoice": {
            "ModbusRtu": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRtuRequestMessage" },
            "ModbusAscii": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAsciiRequestMessage" },
            "ModbusTcp": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusTcpRequestMessage" }
          }
        },
        "modbusResponseMessage": {
          "sdfChoice": {
            "ModbusRtu": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRtuResponseMessage" },
            "ModbusAscii": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAsciiResponseMessage" },
            "ModbusTcp": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusTcpResponseMessage" }
          }
        }      
      }, 

      "sdfAction": {
        "sendRequest": {
          "sdfInputData": {
            "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusRequestMessage"
          }
        }, 
        "sendResponse": { 
          "sdfInputData": {
            "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusResponseMessage"
          }
        }
      },

      "sdfEvent": {
        "receiveRequest": {
          "sdfOutputData": {
            "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusRequestMessage"
          }
        },
        "receiveResponse": {
          "sdfOutputData": {
            "sdfRef": "#/sdfObject/modbusMessage/sdfProperty/modbusReqsponseMessage"
          }
        },
        "modbusException": {
          "sdfOutputData": {
             "sdfRef": "#/sdfObject/sdfData/modbusExceptionCode" 
          }
        }
      },

      "sdfData": {

        "modbusRtuRequestMessage": {
          "type": "object",
          "properties": {
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRequestMessageData" },
            "CheckData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData16" }
          }
        },
        "modbusAsciiRequestMessage": {
          "type": "object",
          "properties": {
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRequestMessageData" },
            "CheckData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData8" }
          }
        },
        "modbusTcpRequestMessage": {
          "type": "object",
          "properties": {
            "TransactionId": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusTransactionID" },
            "ProtocolId": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusProtocolID" },
            "MessageLength": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/length" },
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRequestMessageData" }
          }
        },

        "modbusRtuResponseMessage": {
          "type": "object",
          "properties": {
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusResponseMessageData" },
            "CheckData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData16" }
          }
        },
        "modbusAsciiResponseMessage": {
          "type": "object",
          "properties": {
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusResponseMessageData" },
            "CheckData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusCheckData8" }
          }
        },
        "modbusTcpResponseMessage": {
          "type": "object",
          "properties": {
            "TransactionId": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusTransactionID" },
            "ProtocolId": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusProtocolID" },
            "MessageLength": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/length" },
            "MessageData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRequestMessageData" }
          }
        },

        "modbusRequestMessageData": {
          "type": "object",
          "properties": {
            "ModbusAddress": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAddress" },
            "ModbusFunctionCode": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionCode" },
            "ModbusRequestData": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusRequestData" }
          }
        },

        "modbusResponseMessageData": {
          "type": "object",
          "properties": {
            "ModbusAddress": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusAddress" },
            "FunctionResponseCode": { 
              "sdfChoice": {
                "Success": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionCode" },
                "Exception": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusFunctionExceptionCode" }
              }
            },
            "FunctionResponseData": {
              "sdfChoice": {
                "Success": { "sdfRef": "#/sdfObject/modbusMessage/sdfData/modbusResponseData" },
                "Exception": { "sdfRef": "#/sdfObject/sdfData/modbusExceptionCode" }
              }
            }
          }
        },

        "modbusTransactionID": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "modbusProtocolID": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "length": {
          "type": "number", 
          "minimum": 0,
          "maximum": 65535
        },
        "modbusAddress": {
          "type": "number", 
          "minimum": 0,
          "maximum": 255
        },      
        "modbusCheckData8": {
          "description": "LRC for ASCII mode",
          "type": "number", 
          "minimum": 0,
          "maximum": 255
        },
        "modbusCheckData16": {
            "description": "CRC for RTU mode",
            "type": "number", 
            "minimum": 0,
            "maximum": 65535
        },

        "modbusFunctionCode": {
          "type": "number", 
          "minimum": 0,
          "maximum": 127,
          "sdfChoice": {
            "readCoilStatus": {
              "const": 1
            },
            "readInputStatus": {
              "const": 2
            },         
            "readHoldingRegisters": {
              "const": 3
            },
            "readInputRegisters": {
              "const": 4
            },
            "forceSingleCoil": {
              "const": 5
            },
            "presetSingleRegister": {
              "const": 6
            },
            "readExceptionStatus": {
              "const": 7
            },
            "forceMultipleCoils": {
              "const": 15
            },
            "presetMultipleRegisters": {
              "const": 16
            },
            "reportResponderID": {
              "const": 17
            }         
          }
        },

        "modbusFunctionExceptionCode": {
          "type": "number", 
          "minimum": 128,
          "maximum": 255,
          "sdfChoice": {
            "readCoilStatusException": {
              "const": 129
            },
            "readInputStatusException": {
              "const": 130
            },         
            "readHoldingRegistersException": {
              "const": 131
            },
            "readInputRegistersException": {
              "const": 132
            },
            "forceSingleCoilException": {
              "const": 133
            },
            "presetSingleRegisterException": {
              "const": 134
            },
            "readExceptionStatusException": {
              "const": 135
            },
            "forceMultipleCoilsException": {
              "const": 143
            },
            "presetMultipleRegistersException": {
              "const": 144
            },
            "reportResponderIDException": {
              "const": 145
            }         
          }
        },

        "modbusExceptionCode": {
          "sdfChoice": {
            "illegalFunction": {
              "const": 1
            },
            "illegalDataAddress": {
              "const": 2
            },
            "illegalDataValue": {
              "const": 3
            },
            "responderFailure": {
              "const": 4
            },
            "acknowledge": {
              "const": 5
            },
            "responderBusy": {
              "const": 6
            }
          }
        },
        "modbusRequestData": {
          "sdfChoice": {
            "ReadCoilStatusRequest": {
              "description": "Function Code 01 - readCoilStatus",
              "type": "array",
              "items": [
                {
                  "description": "Starting Address",
                  "type": "number",
                  "minimum": 0,
                  "maximum": 65535
                },
                {
                  "description": "Number of points",
                  "type": "number",
                  "minimum": 0,
                  "maximum": 65535
                }
              ]
            },
            "UnknownRequestType": {
              "description": "validate as an opaque payload",
              "type": "string",
              "subType": "byteString",
              "minLength": 0
            }
          }
        },
        "modbusResponseData": {
          "sdfChoice": {
            "ReadCoilStatusResponse": {
              "description": "Function Code 01 - readCoilStatus",
              "type": "array",
              "items": [
                {
                  "description": "Byte Count",
                  "type": "number",
                  "minimum": 0,
                  "maximum": 255
                },
                {
                  "description": "Coil Data",
                  "type": "string",
                  "subType": "byteString"
                }
              ]
            },
            "UnknownRequestType": {
              "description": "validate as an opaque payload",
              "type": "string",
              "subType": "byteString",
              "minLength": 0
            }
          }
        }
      }
    }
  }
}